{% extends 'base.html' %} {% block conteudo %}
<div class="container" style="background-color: #c91c39; color: #000; border: 2px solid #c91c39;">
  <nav class="navbar navbar-expand-lg bg-body-tertiary">
    <div class="container-fluid">
      <a class="btn btn-danger me-3" href="{{ url_for('cadastro') }}">Cadastro</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup"
        aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
        <!-- Links à esquerda -->
        <div class="navbar-nav">
          <a class="btn btn-danger me-3" href="administrador">Administrador</a>
          <a class="btn btn-danger me-3" href="{{ url_for('cadastraProdutos') }}">Cadastro de produtos</a>
          <a class="btn btn-danger me-3" href="{{ url_for('relatorios') }}">Relatorios</a>
        </div>


        <div class="navbar-nav ms-auto">
          <a class="btn btn-danger" href="{{ url_for('logout') }}">Sair</a>
        </div>
      </div>


    </div>
</div>
<div class="container mt-4">
  <h2 class="mb-4">Produtos disponíveis</h2>

  <!-- Contador -->
  <p>{{ produtos|length }} produto(s) carregado(s).</p>

  <div class="row">
    {% for produto in produtos %}
    <div class="col-md-3 mb-3">
      <div class="card h-100 shadow-sm" style="font-size: 0.9rem">
        <!-- Imagem -->
        {% if produto.link %}
        <img
          src="{{ produto.link }}"
          class="card-img-top"
          alt="{{ produto.nome }}"
          style="width: 100%; height: 180px; object-fit: cover"
        />
        {% else %}
        <img
          src="{{ url_for('static', filename='img/' ~ produto.link) }}"
          class="card-img-top"
          alt="{{ produto.nome }}"
          style="width: 100%; height: 180px; object-fit: cover"
        />

        {% endif %}

        <div class="card-body p-2">
          <h6 class="card-title">{{ produto.nome }}</h6>
          <p class="card-text mb-1">
            <strong>Marca:</strong> {{ produto.marca }} <br />
            <strong>Preço:</strong> R$ {{ "%.2f"|format(produto.preco) }}
          </p>
          <small class="text-muted">{{ produto.descricao }}</small>
        </div>

        <div class="card-footer p-2">
          <!-- Comentários -->
          <h6 style="font-size: 0.85rem">Comentários:</h6>
          <ul class="list-unstyled mb-1" style="font-size: 0.8rem">
            {% for comentario in comentarios if comentario.produto_id ==
            produto.id %}
            <li>
              <strong>{{ comentario.nome_usuario }}:</strong> {{
              comentario.texto }}
            </li>
            {% else %}
            <li>Nenhum comentário ainda.</li>
            {% endfor %}
          </ul>

          <!-- Formulário de comentário (sem campo nome) -->
          <form
            action="{{ url_for('comentar', produto_id=produto.id) }}"
            method="POST"
            class="mt-1"
          >
            <div class="mb-1">
              <textarea
                name="texto"
                class="form-control form-control-sm"
                placeholder="Escreva um comentário"
              ></textarea>
            </div>
            <button type="submit" class="btn btn-primary btn-sm">
              Comentar
            </button>
          </form>
        </div>
      </div>
    </div>
    {% else %}
    <p>Nenhum produto disponível.</p>
    {% endfor %}
  </div>
</div>
{% endblock %}
