<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Minha Loja</title>

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />

    <style>
      body {
        background-color: #f8f9fa;
      }
      .card-custom {
        border: 1px solid #007bff;
        border-radius: 8px;
        transition: transform 0.2s;
        padding: 8px;
      }
      .card-custom:hover {
        transform: scale(1.03);
      }
      .btn-custom {
        background-color: #007bff;
        color: white;
        font-size: 0.8rem;
        padding: 4px 8px;
        border-radius: 4px;
      }
      .btn-custom:hover {
        background-color: #0056b3;
      }
      .card-img-top {
        height: 120px;
        object-fit: cover;
        border-bottom: 1px solid #007bff;
      }
      .card-title {
        font-size: 1rem;
        margin-bottom: 0.3rem;
      }
      .card-text {
        font-size: 0.8rem;
      }
      .comentarios {
        max-height: 200px;
        overflow-y: auto;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
      <div class="container">
        <a
          class="navbar-brand"
          href="{% if session.get('usuario_id') %}{{ url_for('loja') }}{% else %}{{ url_for('login') }}{% endif %}"
          >Minha Loja</a
        >
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarNav"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarNav">
          <ul class="navbar-nav ms-auto">
            {% if session.get('usuario_id') %}
            <li class="nav-item">
              <a class="nav-link active" href="{{ url_for('loja') }}"
                >Produtos</a
              >
            </li>
            {% if session.get('usuario_tipo') == 'administrador' %}
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('cadastraProdutos') }}"
                >Cadastrar Produtos</a
              >
            </li>
            {% endif %}
            <li class="nav-item"><a class="nav-link" href="#">Contato</a></li>
            <li class="nav-item">
              <a class="nav-link" href="{{ url_for('logout') }}">Sair</a>
            </li>
            {% else %}
            <li class="nav-item">
              <a class="nav-link active" href="{{ url_for('login') }}">Login</a>
            </li>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>

    <div class="container my-4">
      {% if session.get('usuario_id') %}
      <h4 class="text-center mb-3">Bem-vindo, {{ session['nome'] }}</h4>
      <h4 class="text-center mb-3">Nossos Produtos</h4>

      <!-- Produtos -->
      <div class="row g-3">
        {% for produto in produtos %}
        <div class="col-6 col-md-4 col-lg-3">
          <div class="card card-custom h-100">
            <img
              src="{{ produto.imagem or 'https://via.placeholder.com/300x120.png?text=Produto' }}"
              class="card-img-top"
              alt="{{ produto.nome }}"
            />
            <div class="card-body p-2">
              <h6 class="card-title">{{ produto.nome }}</h6>
              <p class="card-text">{{ produto.descricao }}</p>

              <!-- Botão Comprar -->
              <a
                href="{{ url_for('comprar_produto', produto_id=produto.id) }}"
                class="btn btn-custom btn-sm mb-1"
                >Comprar</a
              >

              <!-- Formulário de comentário -->
              <form method="POST">
                <input
                  type="hidden"
                  name="produto_id"
                  value="{{ produto.id }}"
                />
                <input
                  type="text"
                  name="texto"
                  placeholder="Deixe seu comentário"
                  class="form-control form-control-sm mb-1"
                />
                <button type="submit" class="btn btn-custom btn-sm w-100">
                  Enviar
                </button>
              </form>

              <!-- Comentários do produto -->
              <div class="comentarios">
                {% for c in comentarios %} {% if c.produto_id == produto.id %}
                <small
                  ><strong>{{ c.nome_usuario }}:</strong> {{ c.texto }}</small
                ><br />
                {% endif %} {% endfor %}
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <div class="alert alert-info text-center">
        Faça login para ver os produtos.
      </div>
      {% endif %}
    </div>
    {% if mensagem %}
    <div class="alert alert-info">{{ mensagem }}</div>
    {% endif %}
    <a href="{{ url_for('logout') }}">Logout</a>


    <!-- Footer -->
    <footer class="bg-primary text-white text-center py-2">
      &copy; 2025 Minha Loja. Todos os direitos reservados.
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
