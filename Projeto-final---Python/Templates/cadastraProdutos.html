{% extends 'base.html' %}

{% block conteudo %}

<div class="container" style="background-color: #c91c39; color: #000; border: 2px solid #c91c39;">
  <nav class="navbar navbar-expand-lg bg-body-tertiary">
    <div class="container-fluid">
      <a class="btn btn-danger me-3" href="{{ url_for('cadastro') }}">Cadastro</a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNavAltMarkup"
        aria-controls="navbarNavAltMarkup" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNavAltMarkup">
        <!-- Links √† esquerda -->
        <div class="navbar-nav">
          <a class="btn btn-danger me-3" href="administrador">Administrador</a>
          <a class="btn btn-danger me-3" href="{{ url_for('cadastraProdutos') }}">Cadastro de produtos</a>
          <a class="btn btn-danger me-3" href="{{ url_for('relatorios') }}">Relatorios</a>
        </div>


        <div class="navbar-nav ms-auto">
          <a class="btn btn-danger" href="{{ url_for('logout') }}">Sair</a>
        </div>
      </div>


    </div>
</div>
<h2 style="text-align:center; margin-bottom: 20px;">Cadastro e Gerenciamento de Produtos</h2>

{% if usuario_tipo == 'administrador' %}
<div style="text-align:center; margin-bottom:15px;">
    <a href="{{ url_for('relatorios') }}"
       style="background-color:#38068e; color:white; padding:8px 16px;
              border-radius:6px; text-decoration:none; font-weight:bold;">
        üìä Acessar Relat√≥rios
    </a>
</div>
{% endif %}

{% if mensagem %}
    <p class="mensagem">{{ mensagem }}</p>
{% endif %}

<div class="form-container">
    <form method="POST">
        <input type="text" name="nome" placeholder="Nome" required>
        <input type="text" name="marca" placeholder="Marca" required>
        <input type="text" name="tipo" placeholder="Tipo" required>
        <input type="number" step="0.01" name="preco" placeholder="Pre√ßo" required>
        <input type="number" name="quantidade" placeholder="Quantidade" required>
        <input type="text" name="link" placeholder="Link da imagem" required>
        <button type="submit" class="btn-cadastrar">Cadastrar Produto</button>
    </form>
</div>

<div class="produtos-container">
    {% for produto in produtos %}
    <div class="card">
        {% if produto.link %}
        <img src="{{ produto.link }}" alt="{{ produto.nome }}" class="card-img">
        {% else %}
        <img src="https://via.placeholder.com/140x70?text=Sem+Imagem" alt="Sem imagem" class="card-img">
        {% endif %}

        <h4>{{ produto.nome }}</h4>
        <p><strong>Marca:</strong> {{ produto.marca }}</p>
        <p><strong>Tipo:</strong> {{ produto.tipo }}</p>
        <p><strong>Pre√ßo:</strong> R$ {{ "%.2f"|format(produto.preco) }}</p>
        <p><strong>Quantidade:</strong> {{ produto.quantidade }}</p>

        {% if usuario_tipo == 'administrador' %}
        <!-- Bot√£o de excluir produto -->
        <form action="{{ url_for('excluir_produto', id=produto.id) }}" method="POST" 
              onsubmit="return confirm('Deseja realmente excluir este produto?');" class="btn-produto-container">
            <button type="submit" class="btn-excluir">Excluir Produto</button>
        </form>
        {% endif %}

        <div class="comentarios-container">
            <strong>Coment√°rios:</strong>
            {% set tem_comentario = false %}
            {% for comentario in comentarios %}
                {% if comentario.produto_id == produto.id %}
                <div class="card-comentario">
                    <span><strong>{{ comentario.nome_usuario }}:</strong> {{ comentario.texto }}</span>
                    {% if usuario_tipo == 'administrador' %}
                    <form method="POST" action="{{ url_for('excluir_comentario', comentario_id=comentario.id) }}" style="display:inline;">
                        <button type="submit" class="btn-excluir-comentario">Excluir</button>
                    </form>
                    {% endif %}
                </div>
                {% set tem_comentario = true %}
                {% endif %}
            {% endfor %}
            {% if not tem_comentario %}
                <span style="font-size:11px; color:#555;">Sem coment√°rios ainda</span>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>

<style>
body { font-family: Arial, sans-serif; margin: 20px; background-color: #f4f4f4; }

.form-container {
    display: flex;
    justify-content: center;
    margin-bottom: 20px;
}

form input {
    padding: 5px;
    margin: 2px;
    border-radius: 5px;
    border: 1px solid #ccc;
    font-size:12px;
}

.btn-cadastrar {
    background-color:#d80b0b;
    color:white;
    border:none;
    padding:5px 10px;
    border-radius:5px;
    cursor:pointer;
    font-size:12px;
}

.btn-cadastrar:hover { background-color:#b10707; }

.produtos-container {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    justify-content: center;
}

.card {
    background-color: white;
    border: 1px solid #ddd;
    border-radius: 10px;
    padding: 8px;
    width: 140px;
    text-align: center;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    transition: transform 0.2s, box-shadow 0.2s;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.card:hover {
    transform: scale(1.05);
    box-shadow: 0 4px 12px rgba(0,0,0,0.3);
}

.card-img {
    width: 100%;
    height: 70px;
    object-fit: cover;
    border-radius: 6px;
    margin-bottom: 6px;
}

.comentarios-container {
    margin-top: 5px;
}

.card-comentario {
    background-color: #f0f0f0;
    border-radius: 5px;
    padding: 3px 5px;
    margin-bottom: 3px;
    font-size: 11px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.btn-excluir {
    background-color:#dc3545;
    color:white;
    border:none;
    padding:3px 6px;
    border-radius:5px;
    cursor:pointer;
    font-size:11px;
    margin-top:4px;
}

.btn-excluir:hover { background-color:#a71d2a; }

.btn-excluir-comentario {
    background-color:transparent;
    border:none;
    color:red;
    cursor:pointer;
    font-size:10px;
}

.btn-produto-container {
    display: flex;
    justify-content: center;
    margin-top: 4px;
}

.mensagem {
    color: rgb(231, 13, 13);
    font-weight: bold;
    margin-top: 10px;
    text-align:center;
}
</style>
{% endblock %}
